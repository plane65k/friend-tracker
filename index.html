let firstLocationUpdate = true; // NEW: track first update

function updateMyMarker(lat,lng){
  if(!myMarker){
    myMarker = L.circleMarker([lat,lng],{
      radius:10,
      color:'#3388ff',
      fillColor:'#3388ff',
      fillOpacity:1
    }).addTo(map);
    myMarker.setRotationAngle(myHeading || 0);
  } else {
    myMarker.setLatLng([lat,lng]);
    myMarker.setRotationAngle(myHeading || 0);
  }

  // Zoom in the first time only
  if(firstLocationUpdate){
    map.setView([lat,lng], 16); // zoom to user location
    firstLocationUpdate = false;
  }
}

// --- Geolocation watcher ---
if (navigator.geolocation) {
  navigator.geolocation.watchPosition(pos => {
    const lat = pos.coords.latitude;
    const lng = pos.coords.longitude;
    updateMyMarker(lat,lng);
    writeLocation(lat,lng,myHeading);
  }, err => console.error('Geo error', err), { enableHighAccuracy:true, maximumAge:5000, timeout:10000 });
}
